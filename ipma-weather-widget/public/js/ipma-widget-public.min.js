!function(t){"use strict";var a=null;t(document).on("ready",function(){var i=t("[data-ipma-widget]");i.length&&i.each(function(i){var e=t(this),n=e.attr("id"),r=null,o=null,l=function(){var t=11;if(f()){var a=localStorage.getItem(n+"_ipma_widget_district");null!=a&&(t=parseInt(a))}return t},d=function(){var t=1110600;if(f()){var a=localStorage.getItem(n+"_ipma_widget_location");null!=a&&(t=parseInt(a))}return t},c=function(a){var i="//api.ipma.pt/json/alldata/"+String(a)+".json";t.ajax({url:i}).then(function(t){for(var a=0;a<t.length;a++){var i=t[a];if(24==i.idPeriodo){var n=m(i.dataPrev),r=e.find("[data-ipma-forecast='"+n+"']");if(r.length){var o=p(i.idTipoTempo);r.find("[data-ipma-forecast-mintemp]").html(parseInt(i.tMin)),r.find("[data-ipma-forecast-maxtemp]").html(parseInt(i.tMax)),r.find("[data-ipma-forecast-precip]").html(parseInt(i.probabilidadePrecipita)),r.find("[data-ipma-forecast-icon]").parent().removeClass("disabled"),r.find("[data-ipma-forecast-icon]").attr("src","//www.ipma.pt/opencms/bin/images.site/otempo/prev.horaria/w_ic_d_"+o+".gif"),void 0!==ipmaWidget_i18n["forecast"+o]&&r.find("[data-ipma-forecast-icon]").attr("title",ipmaWidget_i18n["forecast"+o])}}}})},s=function(i){if(null==a){t.ajax({url:"//api.ipma.pt/json/locations.json"}).then(function(t){a=t,r.trigger("change")});return null}for(var e=[],n=0;n<a.length;n++){var o=a[n];if(o.idDistrito==i){var l=!1;o.globalIdLocal==d()&&(l=!0);var c=new Option(o.local,o.globalIdLocal,l,l);e.push(c)}}return e},p=function(t){return t<10&&(t="0"+t),t},m=function(t){var a=new Date(t),i=""+(a.getMonth()+1),e=""+a.getDate(),n=a.getFullYear();return i.length<2&&(i="0"+i),e.length<2&&(e="0"+e),[n,i,e].join("-")},f=function(){var t="test_string";try{return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(t){return!1}};!function(){(r=e.find("[data-ipma-widget-district]").attr("disabled","disabled").select2()).data("select2").$dropdown.addClass("ipma-widget-select-dropdown"),(o=e.find("[data-ipma-widget-location]").attr("disabled","disabled").select2()).data("select2").$dropdown.addClass("ipma-widget-select-dropdown");t.ajax({url:"//api.ipma.pt/json/districts.json"}).then(function(a){var i=l();r.empty();for(var e=0;e<a.length;e++){var n=!1;a[e].idDistrito===i&&(n=!0);var o=new Option(a[e].nome,a[e].idDistrito,n,n);r.append(o)}r.removeAttr("disabled"),r.trigger("change"),t("[data-ipma-widget-forecasts]").slideDown()}).fail(function(a,i,e){t("[data-ipma-widget-unavailabe]").slideDown()});r.on("change",function(a){var i=t(this).val(),e=s(i);if(null===e)return!1;e.sort(function(t,a){return t.label.localeCompare(a.label)}),o.empty().append(e),o.removeAttr("disabled"),o.trigger("change")}),o.on("change",function(a){var i=t(this).val();c(i),localStorage.setItem(n+"_ipma_widget_location",i),localStorage.setItem(n+"_ipma_widget_district",r.val())})}()})})}(jQuery);